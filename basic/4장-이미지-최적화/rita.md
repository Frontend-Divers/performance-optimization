# Chapter 04 이미지 최적화

## 4.1 이미지의 중요성

웹 사이트에서 사용된 이미지 크기와 개수의 변화를 나타낸 그래프

개수와 크기의 증가



![image](https://user-images.githubusercontent.com/48556400/147633692-a7c75fee-5788-4c14-98d5-8fd727da7fee.png)

[이미지 출처 원본링크](https://httparchive.org/reports/state-of-images?start=earliest&end=latest&view=list)

- 화소밀도: 물리 스크린 공간 안에 얼마나 많은 픽셀이 압축되어있는가
- 픽셀과 포인트 차이점
  - 40px이미지는 말 그대로 40px의 이미지 하나를 의미
  - 40포인트 이미지는 1x에서는 40px, 2x에서는 80px...
- Hero이미지, 또는 대문 이미지의 중요성
  - 비즈니스 부서에선 구매자의 눈길을 끌기 위해 크고 선명한, 화려한 이미지를 요구
  - 디자이너가 만든 고품질 이미지를 그대로 사용하면 웹 성능 문제가 발생

## 4.2 디지털 이미지의 종류와 특성

- 이미지를 잘 사용하기 위한 노력
  - 이미지의 종류와 특성을 파악해야한다.
  - 사용될 기기 타입과 용도에 맞춰 적절한 이미지를 선택해야한다.

- 모바일 이미지가 데크스톱용 이미지보다 무거운 이유
  - 모바일 이미지에 PNG 타입을 사용
  - PNG는 알파 채널이라는 이미지 변환 기법을 사용함
  - 알파채널의 장점 : 핵심 이미지 레이어를 제외한 배경 이미지를 제거하여, 전체 이미지를 투명하게 만들어 사용할 수 있음
  - 알파채널의 단점 : 같은 품질의 JPEG 대비 파일 사이즈가 커짐
- 페이지 로딩 시간이 1초 느려질 경우 상품을 구매하는 사용자의 비율이  약 7% 감소할 수 있다.

### 4.2.1 래스터 이미지 vs 벡터 이미지

- 분류 기준 : 디지털 화면에 이미지들을 어떻게 표현하는가

- 레스터 이미지 : 우리가 사용하는 대부분의 이미지 유형

  - 작은 사각형 모양의 픽셀에 표현하고자 하는 색상 정보를 입력해 이를 컴퓨터로 표현
  - 각각의 픽셀이 모여 하나의 큰 이미지를 완성
  - 단점 : 사이즈가 크거나 품질이 더 좋은 이미지를 만들려면 그만큼의 정보를 담은 픽셀들을 추가해야 컴퓨터가 이를 정상적으로 표현할 수 있음. 확장성 떨어짐.

- 벡터 이미지 : 그리고자 하는 대상의 수학적인 정보를 제공

  - 그림이 위치할 좌표, 형상, 크기, 색상 등의 정보를 제공하여 컴퓨터가 그림을 그리듯 화면에 표현
  - 대표적으로 SVG 파일이 W3C 표준 포맷으로 가장 많이 사용됨
  - 화면 스케일에 상관없이 정보가 유지되기 때문에 항상 선명한 이미지를 표현할 수 있음
  - 단점 :  그림이 복잡해지면 이를 표현하기 위한 정보가 기하급수적으로 늘어나 수학적인 정보로 표현한느데 제약이 생김

  

- SVG 파일

  - 텍스트 기반 콘텐츠
  - gzip이나 brotli 같은 텍스트 압축 기법으로 간단히 최적화 가능
  - zopfli 압축 기법으로 swvz 파일을 만들어 사용

### 4.2.2 무손실 이미지 형식 vs 손실 이미지 형식

- 무손실 이미지 
  - 원본 이미지의 정보 손실을 허용하지 않음
  - 예 ) GIF, PNG

- 손실 이미지
  - 필요에 따라 이동할 수 있는 형태를 만들기 위해 정보 손실을 어느 정도 허용
  - 예 ) JPEG, WebP, JPEG XR, JPEG 2000 등 브라우저에 특화된 이미지

- GIF
  - 이동식 이미지 형식
  - 가용색상 256컬러
  - 트루컬러타입인 GIF로 변형가능하지만 파일 사이즈가 매우 커져서 비효율적
  - 화려한 색상이나 복잡한 이미지보다 기업로고 등 단순한 이미지 표현에 적합
- PNG
  - 배경 : GIF 단점과 특허문제 해결을 위해 개발됨
  - 24비트 색상(2^24개) 사용으로 GIF보다 고품질 이미지 표현
  - 알파 채널이라 불리는 투명 기능
- JPEG
  - Joint Photographic Experts Group
  - 표준 형식
  - 배경 : RAW 형싱 파일은 용량이 크기에 네트워크 전송/웹 게시에 어려움. 이를 극복하기 위해 개발됨
  - 사람의 눈이 인식할 수 있는 색상만 남기고 나머지를 제거
  - 고해상도 이미지를 크게 압축한 파일로 저장가능
  - 품질 값을 사용자가 결정가능. 
  - 품질값 범위 : 0-100(100으로 결정해도 약간의 품질 손실이 발생)
- 어떤 경우에 사용?
  - 동일한 이미지를 여러번 편집해야하는 경우 - 비트맵, PNG 등 무손실 이미지 파일을 사용
  - 편집을 완료시점에 JPEG로 저장
- JPEG 2000
  - 배경 : JPEG의 단점을 보완하기 위해 개발됨 
- WebP
  - 구글에서 개발하고 배포한 이미지 형식
  - JPEG보다 개선된 공격적 압축 방식
  - 무손실 압축, 애니메이션 기능, 투명 기능을 모두 지원
- JPEG XR
  - 마이크로소프트사에서 개발
  - JPEG에 비해 R/G/B에 해당하는 색상 채널당 더 많은 수의 채색을 허용해서 표현할 수 있는 색상 범위를 확장
  - 무손실 압축, 투명 기능, 점진적 데이터 전송 기능 지원

## 4.3 이미지 변환 기법

- 목표 : 선택한 이미지가 웹에 최적화되도록 변환하는 방법을 알아보자
- 이미지 파일 크기 줄이기
- 웹 상에서 빠르게 전송하는 법
- (원시 파일을 다양한 이미지 형식으로 변환하는 방법에 대해선 이 책의 범위를 벗어남 -> advanced)

### 4.3.1 무손실 압축

무손실 압축을 하려면 각 이미지 유형을 다르게 해야한다.

대체로 스크립트를 통해 압축을 자동화할 수 있다.

무료로 배포되는 라이브러리의 명령어를 이용하여 자동화하는 방법을 소개한다.

- GIF : ImageMagicK, Giflossy, Gifsicle, gif2webp converter
- PNG
  - PNG임을 알리는 첫 8바이트의 서명(구분자)를 제외하고 청크(chunk) 형태로 이미지 정보를 저장함
  - 이미지 정보를 저장하는 것이 핵심 청크
  - 히스토그램 관련 데이터, 정보성 청크 등 사용자 청크를 추가할 수 있음
  - 웹 렌더링에 필요하지 않은 청크는 삭제할 수 있음
  - 라이브러리 : Pngcrush, Pngquant, OptiPNG&Zopfli, PngOptiizer
- JPEG
  - 이미지 정보 외에도 많은 메타 데이터가 포함되어있음
  - 메타데이터 예 : 주석 및 공백, 편집 애플리케이션 정보, 사진 위치 정보, 날짜 등
  - 웹에 게시할 땐 메타데이터가 필요없으므로 삭제하면 파일 크기를 줄일 수 있다.
  - 라이브러리 : MozJPEG, libJpeg, Guetzli

### 4.3.2 손실 압축

특정 이미지 정보를 누락, 즉 손실시켜 파일 크기를 줄이는 방법이 있다.

웹상에 게시할 때 성능과 화질 사이의 득실을 따져봐야한다.

손실 압축 기법을 잘 사용하면 사용자의 시각적 경험은 훼손하지 않으면서 로딩 속도를 눈에 띄게 향상시킬 수 있다.

사람이 품질 저하를 거의 눈치채지 못하면서 파일 크기를 가장 크게 줄일 수 있는 품질은 100~75%

작동 원리 : 기존 이미지 형식을 디코딩한 후 알고리즘에 따라 원하는 화질로 저하시켜 다시 원래 이미지 형식으로 인코딩해야한다. 이러한 일련의 작업을 ImageMagick이 지원

최적의 품질 지수를 찾기 위한 대표적인 알고리즘 : 평균 제곱 오차, 최대 신호 대 잡음비, 구조적 유사도

## 4.4 반응형 웹에서의 이미지 배치 전략

엠닷사이트 : 기존 데스크톱용 도메인의 www부분을 m으로 바꾸어 사용

단점 

- 기기 크기가 다양해짐 ->엠닷 사이트 하나만으로 모든 기기의 사용자들을 대응할 수 없어짐
- 유지 보수의 문제점 : 모바일 버전 사이트를 동시에 개발하고 관리해야함
- 모바일 사용자의 사용성 문제 : 유지보수가 어려워짐에 따라 몇 가지 중요한 기능들이 누락되거나, UI/UX가 달라져 불편을 겪게됨



반응형 웹의 등장

- 동일한 웹사이트가 각 기기 화면에 최적화된 구조로 변경되어 제공됨
- 기기별 웹사이트를 구축하지 않아도 되기 때문에 유지보수의 필요성이 줄어듬
- SEO 측면의 이점

### 4.4.1 반응형 웹의 문제점

초기, 성능 측면에서 효과적이지 않음

모바일 환경은 데스크톱 환경에 비해 열악하여 페이지 로딩 시간이 들여짐. LTE 환경에서 케이블에 비해 절반 정도의 데이터를 처리하고 2배 정도 시간 지연이 발생함.

데스크톱에 비해 모바일 기기의 GPU, 메모리 등의 사양이 좋지 않아 모바일 환경에서 페이지 로딩 시간이 더욱 길어짐.

### 4.4.2 원인은 이미지

사용자의 웹 환경에 따라 변하지 않는 이미지.

반응형 웹의 기본 기술 : 미디어 쿼리, 가변 그리드, 유동형 이미지 



사용자의 기기 화면이 작아졌는데도 필요 이상의 웹 리소스들을 과하게 내려받는 현상을 세가지로 구분

- 내려받아 줄이기
- 내려받아 숨기기
- 화면 바깥 부분

### 4.4.3 반응형 이미지

반응형 웹의 문제점 : 모바일 환경에서 필요하지 않은 리소스들을 과도하게 다운로드함

해결 : 사용자의 환경에 따라 적합한 이미지를 전송한다.

유동형 이미지 처럼 브라우저에서 다운로드한 후 처리하는 방법과는 다름.

### 4.4.4 반응형 이미지 구현 방법

## 4.5 적응형 이미지 전략

### 4.5.1 적응형 이미지 아키텍처

### 4.5.2 기기 정보에 따라 서버 로직 수행

### 4.5.3 브라우저별 이미지 전달

### 4.5.4 캐시 고려 사항
